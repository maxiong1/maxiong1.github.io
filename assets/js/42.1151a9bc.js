(window.webpackJsonp=window.webpackJsonp||[]).push([[42],{540:function(t,a,s){"use strict";s.r(a);var n=s(35),e=Object(n.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"技术选型的几项原则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#技术选型的几项原则"}},[t._v("#")]),t._v(" 技术选型的几项原则")]),t._v(" "),s("ul",[s("li",[t._v("易用性")]),t._v(" "),s("li",[t._v("平台通用性")]),t._v(" "),s("li",[t._v("社区支持")]),t._v(" "),s("li",[t._v("侵入性")]),t._v(" "),s("li",[t._v("可维护性")]),t._v(" "),s("li",[t._v("其他")])]),t._v(" "),s("h2",{attrs:{id:"为啥是jsbridge"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#为啥是jsbridge"}},[t._v("#")]),t._v(" 为啥是JSBridge")]),t._v(" "),s("p",[t._v("前端web还是javascript，bridge 桥梁的意思")]),t._v(" "),s("p",[t._v("就是连接native与js前端的桥梁")]),t._v(" "),s("p",[t._v("WebView作为承载H5页面的容器，有一个特性是非常重要，即"),s("code",[t._v("它可以捕捉到所有在容器中发起的网络请求")]),t._v("。其实想要"),s("code",[t._v("JS唤起Native")]),t._v("的方法，只要建立起"),s("code",[t._v("JS与Native通信")]),t._v("的桥梁即可，而这一点正好被WebView的这一特性所实现。")]),t._v(" "),s("h2",{attrs:{id:"wkwebview、uiwebview"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#wkwebview、uiwebview"}},[t._v("#")]),t._v(" WKWebView、UIWebView")]),t._v(" "),s("ul",[s("li",[t._v("WKWebView很多交互都是异步的")]),t._v(" "),s("li",[t._v("比 UIWebView 内存占用小那么多，主要是因为网页的载入和渲染这些耗内存和性能的过程都是由 WKWebView 进程去实现的")])]),t._v(" "),s("h2",{attrs:{id:"实现方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现方式"}},[t._v("#")]),t._v(" 实现方式")]),t._v(" "),s("p",[t._v("我们公司的")]),t._v(" "),s("h3",{attrs:{id:"schema-拦截url"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#schema-拦截url"}},[t._v("#")]),t._v(" schema (拦截url)")]),t._v(" "),s("p",[t._v("不支持return、callback，而且还是单向的；")]),t._v(" "),s("p",[t._v("但是native可以调用js,传入参数")]),t._v(" "),s("ul",[s("li",[t._v("iframe")]),t._v(" "),s("li",[t._v("window.location.href")])]),t._v(" "),s("h3",{attrs:{id:"window"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#window"}},[t._v("#")]),t._v(" window")]),t._v(" "),s("p",[t._v("在window下注入方法供我们调用")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 前端")]),t._v("\nwindow"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("getSystemInfo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 原生")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("webView evaluateJavaScript"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("@“ getSystemInfo ” completionHandler"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id _Nullable response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" NSError "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" _Nullable error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("NSLog")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("@"),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"value: %@ error: %@"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" response"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" error"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("h2",{attrs:{id:"传递消息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#传递消息"}},[t._v("#")]),t._v(" 传递消息")]),t._v(" "),s("p",[t._v("我们可以通过"),s("code",[t._v("发起网络请求来向Native端传递消息")]),t._v("，如通过子窗口iframe.src来发起请求。当然，使用location.href也可以发起请求，不过由于location.href作为当前页面的地址，所以并不推荐使用。")]),t._v(" "),s("div",{staticClass:"language-js extra-class"},[s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("schemeJump")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("url")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 通过iframe子窗口发起网络请求")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" iframe "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("createElement")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'iframe'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  iframe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" url\n  iframe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1px'")]),t._v("\n  iframe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1px'")]),t._v("\n  iframe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("display "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'none'")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不显示iframe")]),t._v("\n  document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("documentElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("appendChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    document"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("documentElement"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("removeChild")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("iframe"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),s("p",[t._v("我们也可以使用ajax来发送网络请求，只要Native端与H5同步一套解析规则即可。不过在实际开发中，由于ajax用于和服务端进行交互，所以最好还是使用iframe子窗口来发送请求。")]),t._v(" "),s("h2",{attrs:{id:"执行回调"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#执行回调"}},[t._v("#")]),t._v(" 执行回调")]),t._v(" "),s("p",[t._v("在唤起Native方法后，往往还需要执行一些回调，由于客户端无法直接执行JS代码，但可以获取WebView中的"),s("code",[t._v("全局变量")]),t._v("，因此可以将回调方法挂载在全局变量上，之后客户端调用全局变量上的回调方法就可以了。")]),t._v(" "),s("p",[t._v("js 端可以封装一层队列，所有 js 代码调用消息都先进入队列并不立刻发送，然后 h5 会周期性比如 500 毫秒，清空一次队列，保证在很快的时间内绝对不会连续发 2 次请求通信。")]),t._v(" "),s("p",[t._v("bridge [不睿之] 桥梁")])])}),[],!1,null,null,null);a.default=e.exports}}]);